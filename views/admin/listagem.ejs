<script src="/js/js/listagem.js" defer></script>
<script src="/js/js/listagem-header.js" defer></script>

<style>
.toast-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    padding: 16px 24px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 10000;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
}
.toast-notification.success {
    border-left: 4px solid #28a745;
}
.toast-notification.error {
    border-left: 4px solid #dc3545;
}
.toast-notification .toast-icon {
    font-size: 24px;
}
.toast-notification.success .toast-icon {
    color: #28a745;
}
.toast-notification.error .toast-icon {
    color: #dc3545;
}
.toast-notification .toast-content {
    flex: 1;
}
.toast-notification .toast-title {
    font-weight: 600;
    margin-bottom: 4px;
    color: #333;
}
.toast-notification .toast-message {
    font-size: 14px;
    color: #666;
}
.toast-notification .toast-close {
    background: none;
    border: none;
    color: #999;
    cursor: pointer;
    font-size: 20px;
    padding: 0;
    width: 24px;
    height: 24px;
}
@keyframes slideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}
.toast-notification.hiding {
    animation: slideOut 0.3s ease-in forwards;
}
.delete-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    animation: fadeIn 0.2s ease-out;
}
.delete-modal.show {
    display: flex;
}
.delete-box {
    background: white;
    border-radius: 12px;
    padding: 24px;
    max-width: 450px;
    width: 90%;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    animation: slideUp 0.3s ease-out;
}
.delete-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 32px;
    background: #f8d7da;
    color: #dc3545;
}
.delete-title {
    font-size: 20px;
    font-weight: 600;
    color: #333;
    margin-bottom: 12px;
    text-align: center;
}
.delete-message {
    font-size: 14px;
    color: #666;
    text-align: center;
    margin-bottom: 8px;
}
.delete-item-name {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 12px;
    margin: 16px 0;
    text-align: center;
    font-weight: 600;
    color: #dc3545;
}
.delete-buttons {
    display: flex;
    gap: 12px;
    margin-top: 20px;
}
.delete-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
}
.delete-btn.cancel {
    background: #f5f5f5;
    color: #666;
}
.delete-btn.cancel:hover {
    background: #e0e0e0;
}
.delete-btn.confirm {
    background: #dc3545;
    color: white;
}
.delete-btn.confirm:hover {
    background: #c82333;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes slideUp {
    from {
        transform: translateY(30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
</style>

<div class="container-fluid">
    <div class="d-flex align-items-center mb-4" style="gap:12px;">
        <h2 class="mb-0" style="font-size: 24px; font-weight: 600; flex-shrink:0;">
            <span id="titleSelected"><% if(tipoListar == 1){ %>Produtos<% } else if(tipoListar == 2){ %>Insumos<% } else if(tipoListar == 3){ %>Serviços<% } else if(tipoListar == 4){ %>Equipamentos Agricolas<% } else if(tipoListar == 5){ %>Marcas<% } else if(tipoListar == 6){ %>Categorias<% } else { %>Listagem de Itens<% } %></span>
        </h2>
        <input type="text" id="searchItens" placeholder="Digite o nome ou ID do item..." style="max-width:300px;" class="form-control" />
        <a href="<% if(tipoListar == 1){ %>/admin/CadastrarProduto<% } else if(tipoListar == 2){ %>/admin/CadastrarProduto<% } else if(tipoListar == 3){ %>/admin/CadastrarServico<% } else if(tipoListar == 4){ %>/admin/CadastrarEqAgricola<% } else if(tipoListar == 5){ %>/admin/CadastrarMarca<% } else if(tipoListar == 6){ %>/admin/CadastrarCategoria<% } else { %>/admin<% } %>" class="btn btn-success ms-auto">+ Incluir cadastro</a>
    </div>
    <div class="form-floating mt-3 d-none">
        <select name="select" id="select" class="form-control">
            <option value="1" <%if(tipoListar == 1){%>selected<%}%>>Produtos</option>
            <option value="2" <%if(tipoListar == 2){%>selected<%}%>>Insumos</option>
            <option value="3" <%if(tipoListar == 3){%>selected<%}%>>Serviços</option>
            <option value="4" <%if(tipoListar == 4){%>selected<%}%>>Equipamentos Agricolas</option>
            <option value="5" <%if(tipoListar == 5){%>selected<%}%>>Marcas</option>
            <option value="6" <%if(tipoListar == 6){%>selected<%}%>>Categorias</option>
        </select>
        <label for="select">Tipo de Item</label>
    </div>

    

    <div class="row" id="1"> <!--LISTA PRODUTOS-->
        <%if(listaProdutos.length == 0) { %>
            <div class="col-12">
                <div class="alert alert-info text-center" role="alert">
                    Nenhum produto cadastrado.
                </div>
            </div>
        <%}%>
        <%for(let i=0;i<listaProdutos.length;i++) {%>
            <div class="col-12 mb-3">
                <div class="card card-clickable" onclick="window.location.href='/admin/alterarItem/1/<%=listaProdutos[i].id%>'" style="cursor: pointer; transition: all 0.2s;">
                    <div class="card-body p-3">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <img src="<%= listaProdutos[i].imagem %>"
                                     alt="<%=listaProdutos[i].nome%>"
                                     style="width: 80px; height: 80px; object-fit: contain; border-radius: 8px; background-color: #f0f0f0;">
                            </div>
                            <div class="col">
                                <h5 class="mb-1"><%=listaProdutos[i].nome%></h5>
                                <div class="d-flex gap-3 text-muted">
                                    <small><strong>ID:</strong> <%=listaProdutos[i].id%></small>
                                    <small><strong>Preço:</strong> R$ <%=listaProdutos[i].preco%></small>
                                    <small data-estoque-text><strong>Estoque:</strong> <span data-estoque-valor><%=listaProdutos[i].estoque%></span></small>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="d-flex gap-2">
                                    <a href="/admin/alterarItem/1/<%=listaProdutos[i].id%>?tab=estoque" class="btn btn-primary btn-sm" onclick="event.stopPropagation()" title="Gerenciar Estoque">
                                        <i class="bi bi-box-seam"></i>
                                    </a>
                                    <button data-id="<%=listaProdutos[i].id%>" data-tipo="1" data-nome='<%=listaProdutos[i].nome%>' class="btn btn-danger btn-sm btnExcluir" onclick="event.stopPropagation()">
                                        <i class="bi bi-trash-fill"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <%}%>
    </div>

    <div class="row" id="2"> <!--LISTA INSUMOS-->
        <%if(listaInsumos.length == 0) { %>
            <div class="col-12">
                <div class="alert alert-info text-center" role="alert">
                    Nenhum insumo cadastrado.
                </div>
            </div>
        <%}%>
        <%for(let i=0;i<listaInsumos.length;i++) {%>
            <div class="col-12 mb-3">
                <div class="card card-clickable" onclick="window.location.href='/admin/alterarItem/2/<%=listaInsumos[i].id%>'" style="cursor: pointer; transition: all 0.2s;">
                    <div class="card-body p-3">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <img src="<%= listaInsumos[i].imagem %>"
                                     alt="<%=listaInsumos[i].nome%>"
                                     style="width: 80px; height: 80px; object-fit: contain; border-radius: 8px; background-color: #f0f0f0;">
                            </div>
                            <div class="col">
                                <h5 class="mb-1"><%=listaInsumos[i].nome%></h5>
                                <div class="d-flex gap-3 text-muted">
                                    <small><strong>ID:</strong> <%=listaInsumos[i].id%></small>
                                    <small><strong>Preço:</strong> R$ <%=listaInsumos[i].preco%></small>
                                    <small data-estoque-text><strong>Estoque:</strong> <span data-estoque-valor><%=listaInsumos[i].estoque%></span></small>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="d-flex gap-2">
                                    <a href="/admin/alterarItem/2/<%=listaInsumos[i].id%>?tab=estoque" class="btn btn-primary btn-sm" onclick="event.stopPropagation()" title="Gerenciar Estoque">
                                        <i class="bi bi-box-seam"></i>
                                    </a>
                                    <button data-id="<%=listaInsumos[i].id%>" data-tipo="1" data-nome='<%=listaInsumos[i].nome%>' class="btn btn-danger btn-sm btnExcluir" onclick="event.stopPropagation()">
                                        <i class="bi bi-trash-fill"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <%}%>
    </div>

    <table class="table table-bordered mt-3" style="color: #000;" id="3"> <!--LISTA Serviços-->
        <thead>
            <th>ID</th>
            <th>Nome</th>
            <th>Preço</th>
            <th>Descrição</th>
            <th>Alterar/Excluir</th>
        </thead>
        <tbody>
            <%if(listaServicos.length == 0) { %>
                <tr>
                    <td colspan="5" class="text-center">Nenhum serviço cadastrado.</td>
                </tr>
            <%}%>
            <%for(let i=0;i<listaServicos.length;i++) {%>
                <tr>
                    <td><%=listaServicos[i].id%></td>
                    <td><%=listaServicos[i].nome%></td>
                    <td><%=listaServicos[i].preco%>R$</td>
                    <td><%=listaServicos[i].descricao%></td>
                    <td>
                        <a href="/admin/alterarItem/3/<%=listaServicos[i].id%>" class="btn btn-primary"><i class="bi bi-pencil-square"></i></a>
                        <button data-id="<%=listaServicos[i].id%>" data-tipo="3"  data-nome='<%=listaServicos[i].nome%>' class="btn btn-danger btnExcluir"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>
            <%}%>
        </tbody>
    </table>

    <table class="table table-bordered mt-3" style="color: #000;" id="4"> <!--LISTA EQUIP AGRICOLA-->
        <thead>
            <th>ID</th>
            <th>Nome</th>
            <th>Proprietário</th>
            <th>Descrição</th>
            <th>Categoria</th>
            <th>Marca</th>
            <th>Alterar/Excluir</th>
        </thead>
        <tbody>
            <%if(listaEqAg.length == 0) { %>
                <tr>
                    <td colspan="7" class="text-center">Nenhum equipamento agrícola cadastrado.</td>
                </tr>
            <%}%>
            <%for(let i=0;i<listaEqAg.length;i++) {%>
                <tr>
                    <td><%=listaEqAg[i].id%></td>
                    <td><%=listaEqAg[i].nome%></td>
                    <td><%=listaEqAg[i].pessoa_nome%></td>
                    <td><%=listaEqAg[i].descricao%></td>
                    <td><%=listaEqAg[i].categoria_nome%></td>
                    <td><%=listaEqAg[i].marca_nome%></td>
                    <td>
                        <a href="/admin/alterarItem/4/<%=listaEqAg[i].id%>" class="btn btn-primary"><i class="bi bi-pencil-square"></i></a>
                        <button data-id="<%=listaEqAg[i].id%>" data-tipo="4"  data-nome='<%=listaEqAg[i].nome%>' class="btn btn-danger btnExcluir"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>
            <%}%>
        </tbody>
    </table>

    <table class="table table-bordered mt-3" style="color: #000;" id="5"> <!--LISTA MARCAS-->
        <thead>
            <th>ID</th>
            <th>Nome</th>
            <th>Alterar/Excluir</th>
        </thead>
        <tbody>
            <%if(listaMarcas.length == 0) { %>
                <tr>
                    <td colspan="3" class="text-center">Nenhuma marca cadastrada.</td>
                </tr>
            <%}%>
            <%for(let i=0;i<listaMarcas.length;i++) {%>
                <tr>
                    <td><%=listaMarcas[i].id%></td>
                    <td><%=listaMarcas[i].nome%></td>
                    <td>
                        <a href="/admin/alterarItem/5/<%=listaMarcas[i].id%>" class="btn btn-primary"><i class="bi bi-pencil-square"></i></a>
                        <button data-id="<%=listaMarcas[i].id%>" data-tipo="5"  data-nome='<%=listaMarcas[i].nome%>' class="btn btn-danger btnExcluir"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>
            <%}%>
        </tbody>
    </table>

    <table class="table table-bordered mt-3" style="color: #000;" id="6"> <!--LISTA CATEGORIAS DE PRODUTOS-->
        <thead>
            <th>ID</th>
            <th>Nome</th>
            <th>Alterar/Excluir</th>
        </thead>
        <tbody>
            <%if(listaCategorias.length == 0) { %>
                <tr>
                    <td colspan="3" class="text-center">Nenhuma categoria cadastrada.</td>
                </tr>
            <%}%>
            <%for(let i=0;i<listaCategorias.length;i++) {%>
                <tr>
                    <td><%=listaCategorias[i].id%></td>
                    <td><%=listaCategorias[i].nome%></td>
                    <td>
                        <a href="/admin/alterarItem/6/<%=listaCategorias[i].id%>" class="btn btn-primary"><i class="bi bi-pencil-square"></i></a>
                        <button data-id="<%=listaCategorias[i].id%>" data-tipo="6"  data-nome='<%=listaCategorias[i].nome%>' class="btn btn-danger btnExcluir"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>
            <%}%>
        </tbody>
    </table>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="delete-modal" id="deleteModal">
    <div class="delete-box">
        <div class="delete-icon">
            <i class="bi bi-exclamation-triangle"></i>
        </div>
        <div class="delete-title">Confirmar Exclusão</div>
        <div class="delete-message" id="deleteMessage">Tem certeza que deseja excluir este item?</div>
        <div class="delete-item-name" id="deleteItemName">Nome do Item</div>
        <div class="delete-buttons">
            <button class="delete-btn cancel" onclick="closeDeleteModal()">Cancelar</button>
            <button class="delete-btn confirm" id="deleteConfirmBtn">Excluir</button>
        </div>
    </div>
</div>