<section class="ftco-section bg-light">
    <div class="container">
        <div class="row justify-content-center mb-3 pb-3">
            <div class="col-md-12 heading-section text-center ftco-animate">
                <h2 class="mb-4">Minhas Devoluções</h2>
                <p>Acompanhe o status das suas solicitações de devolução</p>
            </div>
        </div>

        <% if (devolucoes && devolucoes.length > 0) { %>
            <div class="row">
                <% devolucoes.forEach(function(devolucao) { %>
                    <div class="col-md-12 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <strong>Devolução #<%= devolucao.id %></strong><br>
                                        <small class="text-muted">Pedido #<%= devolucao.idVenda %></small>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted">Data da Solicitação</small><br>
                                        <%= new Date(devolucao.venda.data).toLocaleDateString('pt-BR') %>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted">Valor Total</small><br>
                                        <strong>R$ <%= parseFloat(devolucao.venda.valorTotal || 0).toFixed(2).replace('.', ',') %></strong>
                                    </div>
                                    <div class="col-md-3 text-right">
                                        <% if (devolucao.status === 'pendente') { %>
                                            <span class="badge badge-warning badge-lg">Aguardando Análise</span>
                                        <% } else if (devolucao.status === 'aprovada') { %>
                                            <span class="badge badge-success badge-lg">Aprovada</span>
                                        <% } else if (devolucao.status === 'recusada') { %>
                                            <span class="badge badge-danger badge-lg">Recusada</span>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <h6 class="mb-3">Itens da Devolução:</h6>
                                <% if (devolucao.itens && devolucao.itens.length > 0) { %>
                                    <div class="row">
                                        <% devolucao.itens.forEach(function(item) { %>
                                            <div class="col-md-12 mb-3">
                                                <div class="d-flex align-items-center p-3 border rounded">
                                                    <% if (item.produto && item.produto.imagem1) { %>
                                                        <img src="/images/produtos/<%= item.produto.imagem1 %>" 
                                                             alt="<%= item.produto.nome %>" 
                                                             style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;" 
                                                             class="mr-3">
                                                    <% } else { %>
                                                        <div class="bg-secondary d-flex align-items-center justify-content-center mr-3" 
                                                             style="width: 80px; height: 80px; border-radius: 8px;">
                                                            <i class="icon-image text-white"></i>
                                                        </div>
                                                    <% } %>
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1"><%= item.produto.nome %></h6>
                                                        <small class="text-muted">Quantidade: <%= item.quantidade %> | Valor: R$ <%= parseFloat(item.preco || 0).toFixed(2).replace('.', ',') %></small>
                                                        <% if (item.motivo) { %>
                                                            <br><small><strong>Motivo:</strong> <%= item.motivo %></small>
                                                        <% } %>
                                                    </div>
                                                    <div class="text-right">
                                                        <strong>R$ <%= (parseFloat(item.preco || 0) * parseInt(item.quantidade || 0)).toFixed(2).replace('.', ',') %></strong>
                                                    </div>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                <% } %>

                                <% if (devolucao.status === 'aprovada') { %>
                                    <div class="alert alert-success mt-3">
                                        <i class="icon-check-circle"></i> 
                                        <strong>Devolução aprovada!</strong> O reembolso será processado em breve.
                                    </div>
                                <% } else if (devolucao.status === 'recusada') { %>
                                    <div class="alert alert-danger mt-3">
                                        <i class="icon-x-circle"></i> 
                                        <strong>Devolução recusada.</strong> Entre em contato conosco para mais informações: +55 11 59346-37275
                                    </div>
                                <% } else { %>
                                    <div class="alert alert-info mt-3">
                                        <i class="icon-clock"></i> 
                                        <strong>Solicitação em análise.</strong> Você será notificado quando houver uma resposta.
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="row">
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-body text-center py-5">
                            <i class="icon-package" style="font-size: 48px; color: #ccc;"></i>
                            <h4 class="mt-3">Nenhuma devolução encontrada</h4>
                            <p class="text-muted">Você ainda não solicitou nenhuma devolução.</p>
                            <a href="/usuario/minhas-compras" class="btn btn-primary mt-3">
                                <i class="icon-shopping-cart"></i> Ver Minhas Compras
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>

        <div class="row mt-4">
            <div class="col-md-12">
                <a href="/usuario/minhas-compras" class="btn btn-outline-secondary">
                    <i class="icon-arrow-left"></i> Voltar para Minhas Compras
                </a>
            </div>
        </div>
    </div>
</section>

<style>
    .badge-lg {
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 600;
    }
    .card {
        border: none;
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-2px);
    }
</style>
